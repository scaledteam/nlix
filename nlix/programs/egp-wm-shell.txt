#
# This E2 made by scaled
#

@name egp-wm-shell

switch (P["state", number]) {
    # Wait console driver
    case 0,
        if (terminalInit()) {
            P["state", number] = 1
        }
        break
    
    # Wait keyboard driver
    case 1,
        if (simpleKeyboardInit()) {
            P["state", number] = 2
        }
        break
    
    # Wait callback device
    case 2,
        if (driverPopDevice("egp-wm-callback")) {
            P["state", number] = 3
        }
        break
    
    # Main state
    case 3,
        terminalPrint("wm-sh: $ ")
        simpleKeyboardRequestInput()
        
        P["state", number] = 4
        break
    
    # Get input
    case 4,
        if (simpleKeyboardWaitInput()) {
            local Input = simpleKeyboardGetInput()
            local Commands = Input:trim():explode(" ")
            
            local CallbackDevice = P["device", table]
            foreach (I, Command:string = Commands) {
                CallbackDevice["queue", array]:pushString(Command)
            }
            P["state", number] = 3
        }
        break
}
