#
# This E2 made by scaled
#

@name lib-driver-egp

@persist LIB_DRIVER_EGP_COLOR_WHITE:vector4

LIB_DRIVER_EGP_COLOR_WHITE = vec4(255)

function table createVirtualEgpScreen(Resolution:vector2, MaxObjects) {
    local Device = object("virtual-egp-screen")
    Device["idle", number] = 1
    
    Device["resolution", vector2] = Resolution
    Device["max-objects", number] = MaxObjects
    
    Device["output-queue", array] = array()
    Device["input-queue", array] = array()
    
    return Device
}

function number egpInit() {
    #[if (varExists("driver-egp")) {
        local App = varTable("driver-egp")
        if (App:varNumber("ready")) {
            return 1
        }
        else {
            return 0
        }
    }
    else {
        local App = findAppByName("driver-egp")
        if (App == NULL) {
            return 0
        }
        else {
            varWrite("driver-egp", App)
            if (App:varNumber("ready")) {
                return 1
            }
            else {
                return 0
            }
        }
    }]#
    return driverInit("driver-egp")
}

function egpBox(Id, Pos:vector2, Size:vector2) {
    local App = varTable("driver-egp")
    
    App:sendEvent("egpBox")
    App:sendEvent(Id)
    App:sendEvent(Pos)
    App:sendEvent(Size)
}

function egpBoxOutline(Id, Pos:vector2, Size:vector2) {
    local App = varTable("driver-egp")
    
    App:sendEvent("egpBoxOutline")
    App:sendEvent(Id)
    App:sendEvent(Pos)
    App:sendEvent(Size)
}

function egpText(Id, Text:string, Pos:vector2) {
    local App = varTable("driver-egp")
    
    App:sendEvent("egpText")
    App:sendEvent(Id)
    App:sendEvent(Text)
    App:sendEvent(Pos)
}

function egpTextLayout(Id, Text:string, Pos:vector2, Size:vector2) {
    local App = varTable("driver-egp")
    
    App:sendEvent("egpTextLayout")
    App:sendEvent(Id)
    App:sendEvent(Text)
    App:sendEvent(Pos)
    App:sendEvent(Size)
}

function egpSetText(Id, Text:string) {
    local App = varTable("driver-egp")
    
    App:sendEvent("egpSetText")
    App:sendEvent(Id)
    App:sendEvent(Text)
}

function egpColor(Id, Color:vector) {
    local App = varTable("driver-egp")
    
    App:sendEvent("egpColor")
    App:sendEvent(Id)
    App:sendEvent(Color)
}

function egpColor4(Id, Color:vector4) {
    local App = varTable("driver-egp")
    
    App:sendEvent("egpColor4")
    App:sendEvent(Id)
    App:sendEvent(Color)
}

function egpAlpha(Id, Alpha) {
    local App = varTable("driver-egp")
    
    App:sendEvent("egpAlpha")
    App:sendEvent(Id)
    App:sendEvent(Alpha)
}

function egpSize(Id, Size:vector2) {
    local App = varTable("driver-egp")
    
    App:sendEvent("egpSize")
    App:sendEvent(Id)
    App:sendEvent(Size)
}

function egpSizeNumber(Id, Size) {
    local App = varTable("driver-egp")
    
    App:sendEvent("egpSizeNumber")
    App:sendEvent(Id)
    App:sendEvent(Size)
}

function egpParent(Id, Id2) {
    local App = varTable("driver-egp")
    
    App:sendEvent("egpParent")
    App:sendEvent(Id)
    App:sendEvent(Id2)
}

function egpParentPoint(Id, Pos:vector2) {
    local App = varTable("driver-egp")
    
    App:sendEvent("egpParentPoint")
    App:sendEvent(Id)
    App:sendEvent(Pos)
}

function egpParentToBase(Id) {
    local App = varTable("driver-egp")
    
    App:sendEvent("egpParentToBase")
    App:sendEvent(Id)
}

function egpAlign(Id, Align) {
    local App = varTable("driver-egp")
    
    App:sendEvent("egpAlign")
    App:sendEvent(Id)
    App:sendEvent(Align)
}

function egpAlign2(Id, Align, Align2) {
    local App = varTable("driver-egp")
    
    App:sendEvent("egpAlign2")
    App:sendEvent(Id)
    App:sendEvent(Align)
    App:sendEvent(Align2)
}

function egpCircle(Id, Pos:vector2, Size:vector2) {
    local App = varTable("driver-egp")
    
    App:sendEvent("egpCircle")
    App:sendEvent(Id)
    App:sendEvent(Pos)
    App:sendEvent(Size)
}

function egpCircleOutline(Id, Pos:vector2, Size:vector2) {
    local App = varTable("driver-egp")
    
    App:sendEvent("egpCircleOutline")
    App:sendEvent(Id)
    App:sendEvent(Pos)
    App:sendEvent(Size)
}

function egpLine(Id, Pos1:vector2, Pos2:vector2) {
    local App = varTable("driver-egp")
    
    App:sendEvent("egpLine")
    App:sendEvent(Id)
    App:sendEvent(Pos1)
    App:sendEvent(Pos2)
}

function egpPos(Id, Pos:vector2) {
    local App = varTable("driver-egp")
    
    App:sendEvent("egpPos")
    App:sendEvent(Id)
    App:sendEvent(Pos)
}

function egpRemove(Id) {
    local App = varTable("driver-egp")
    
    App:sendEvent("egpRemove")
    App:sendEvent(Id)
}

function egpCopy(Id, Id2) {
    local App = varTable("driver-egp")
    
    App:sendEvent("egpCopy")
    App:sendEvent(Id)
    App:sendEvent(Id2)
}

function egpMove(Id, Id2) {
    local App = varTable("driver-egp")
    
    App:sendEvent("egpMove")
    App:sendEvent(Id)
    App:sendEvent(Id2)
}

function egpDrawTopLeft(Enable) {
    local App = varTable("driver-egp")
    
    App:sendEvent("egpDrawTopLeft")
    App:sendEvent(Enable)
}

function vector2 egpResolution() {
    return varTable("driver-egp"):varVector2("resolution")
}

function number egpIsIdle() {
    return varTable("driver-egp"):varNumber("idle")
}

function number egpMaxObjects2() {
    return varTable("driver-egp"):varNumber("egpMaxObjects")
}

function number egpParent(Id) {
    return varTable("driver-egp"):varTable("egpObjects")[Id, table]["parent", number]
}

function vector egpColor(Id) {
    return vec(varTable("driver-egp"):varTable("egpObjects")[Id, table]["color", vector4])
}

function vector4 egpColor4(Id) {
    return varTable("driver-egp"):varTable("egpObjects")[Id, table]["color", vector4]
}

function number egpHasObject(Id) {
    return varTable("driver-egp"):varTable("egpObjects")[Id, table]["exists", number]
}

function vector2 egpPos(Id) {
    return varTable("driver-egp"):varTable("egpObjects")[Id, table]["pos", vector2]
}

function vector2 egpSize(Id) {
    return varTable("driver-egp"):varTable("egpObjects")[Id, table]["size", vector2]
}

function string egpType(Id) {
    return varTable("driver-egp"):varTable("egpObjects")[Id, table]:type()
}
