#
# This E2 made by scaled
#

@name lib-driver-egp

@persist LIB_DRIVER_EGP_COLOR_WHITE:vector4

LIB_DRIVER_EGP_COLOR_WHITE = vec4(255)

function table createVirtualEgpScreen(Resolution:vector2, MaxObjects) {
    local Device = object("virtual-egp-screen")
    Device["idle", number] = 1
    
    Device["resolution", vector2] = Resolution
    Device["max-objects", number] = MaxObjects
    
    Device["output-queue", array] = array()
    Device["input-queue", array] = array()
    
    return Device
}

function number egpInit() {
    #[if (varExists("driver-egp")) {
        local App = varTable("driver-egp")
        if (App:varNumber("ready")) {
            return 1
        }
        else {
            return 0
        }
    }
    else {
        local App = findAppByName("driver-egp")
        if (App == NULL) {
            return 0
        }
        else {
            varWrite("driver-egp", App)
            if (App:varNumber("ready")) {
                return 1
            }
            else {
                return 0
            }
        }
    }]#
    return driverInit("driver-egp")
}

function egpBox(Id, Pos:vector2, Size:vector2) {
    local App = varTable("driver-egp")
    
    App:eventSend("egpBox")
    App:eventSend(Id)
    App:eventSend(Pos)
    App:eventSend(Size)
}

function egpBoxOutline(Id, Pos:vector2, Size:vector2) {
    local App = varTable("driver-egp")
    
    App:eventSend("egpBoxOutline")
    App:eventSend(Id)
    App:eventSend(Pos)
    App:eventSend(Size)
}

function egpText(Id, Text:string, Pos:vector2) {
    local App = varTable("driver-egp")
    
    App:eventSend("egpText")
    App:eventSend(Id)
    App:eventSend(Text)
    App:eventSend(Pos)
}

function egpTextLayout(Id, Text:string, Pos:vector2, Size:vector2) {
    local App = varTable("driver-egp")
    
    App:eventSend("egpTextLayout")
    App:eventSend(Id)
    App:eventSend(Text)
    App:eventSend(Pos)
    App:eventSend(Size)
}

function egpSetText(Id, Text:string) {
    local App = varTable("driver-egp")
    
    App:eventSend("egpSetText")
    App:eventSend(Id)
    App:eventSend(Text)
}

function egpColor(Id, Color:vector) {
    local App = varTable("driver-egp")
    
    App:eventSend("egpColor")
    App:eventSend(Id)
    App:eventSend(Color)
}

function egpColor4(Id, Color:vector4) {
    local App = varTable("driver-egp")
    
    App:eventSend("egpColor4")
    App:eventSend(Id)
    App:eventSend(Color)
}

function egpAlpha(Id, Alpha) {
    local App = varTable("driver-egp")
    
    App:eventSend("egpAlpha")
    App:eventSend(Id)
    App:eventSend(Alpha)
}

function egpSize(Id, Size:vector2) {
    local App = varTable("driver-egp")
    
    App:eventSend("egpSize")
    App:eventSend(Id)
    App:eventSend(Size)
}

function egpSizeNumber(Id, Size) {
    local App = varTable("driver-egp")
    
    App:eventSend("egpSizeNumber")
    App:eventSend(Id)
    App:eventSend(Size)
}

function egpParent(Id, Id2) {
    local App = varTable("driver-egp")
    
    App:eventSend("egpParent")
    App:eventSend(Id)
    App:eventSend(Id2)
}

function egpParentPoint(Id, Pos:vector2) {
    local App = varTable("driver-egp")
    
    App:eventSend("egpParentPoint")
    App:eventSend(Id)
    App:eventSend(Pos)
}

function egpParentToBase(Id) {
    local App = varTable("driver-egp")
    
    App:eventSend("egpParentToBase")
    App:eventSend(Id)
}

function egpAlign(Id, Align) {
    local App = varTable("driver-egp")
    
    App:eventSend("egpAlign")
    App:eventSend(Id)
    App:eventSend(Align)
}

function egpAlign2(Id, Align, Align2) {
    local App = varTable("driver-egp")
    
    App:eventSend("egpAlign2")
    App:eventSend(Id)
    App:eventSend(Align)
    App:eventSend(Align2)
}

function egpCircle(Id, Pos:vector2, Size:vector2) {
    local App = varTable("driver-egp")
    
    App:eventSend("egpCircle")
    App:eventSend(Id)
    App:eventSend(Pos)
    App:eventSend(Size)
}

function egpCircleOutline(Id, Pos:vector2, Size:vector2) {
    local App = varTable("driver-egp")
    
    App:eventSend("egpCircleOutline")
    App:eventSend(Id)
    App:eventSend(Pos)
    App:eventSend(Size)
}

function egpLine(Id, Pos1:vector2, Pos2:vector2) {
    local App = varTable("driver-egp")
    
    App:eventSend("egpLine")
    App:eventSend(Id)
    App:eventSend(Pos1)
    App:eventSend(Pos2)
}

function egpPos(Id, Pos:vector2) {
    local App = varTable("driver-egp")
    
    App:eventSend("egpPos")
    App:eventSend(Id)
    App:eventSend(Pos)
}

function egpRemove(Id) {
    local App = varTable("driver-egp")
    
    App:eventSend("egpRemove")
    App:eventSend(Id)
}

function egpCopy(Id, Id2) {
    local App = varTable("driver-egp")
    
    App:eventSend("egpCopy")
    App:eventSend(Id)
    App:eventSend(Id2)
}

function egpMove(Id, Id2) {
    local App = varTable("driver-egp")
    
    App:eventSend("egpMove")
    App:eventSend(Id)
    App:eventSend(Id2)
}

function egpDrawTopLeft(Enable) {
    local App = varTable("driver-egp")
    
    App:eventSend("egpDrawTopLeft")
    App:eventSend(Enable)
}

function vector2 egpResolution() {
    return varTable("driver-egp"):varVector2("resolution")
}

function number egpIsIdle() {
    return varTable("driver-egp"):varNumber("idle")
}

function number egpMaxObjects2() {
    return varTable("driver-egp"):varNumber("egpMaxObjects")
}

function number egpParent(Id) {
    return varTable("driver-egp"):varTable("egpObjects")[Id, table]["parent", number]
}

function vector egpColor(Id) {
    return vec(varTable("driver-egp"):varTable("egpObjects")[Id, table]["color", vector4])
}

function vector4 egpColor4(Id) {
    return varTable("driver-egp"):varTable("egpObjects")[Id, table]["color", vector4]
}

function number egpHasObject(Id) {
    return varTable("driver-egp"):varTable("egpObjects")[Id, table]["exists", number]
}

function vector2 egpPos(Id) {
    return varTable("driver-egp"):varTable("egpObjects")[Id, table]["pos", vector2]
}

function vector2 egpSize(Id) {
    return varTable("driver-egp"):varTable("egpObjects")[Id, table]["size", vector2]
}

function string egpType(Id) {
    return varTable("driver-egp"):varTable("egpObjects")[Id, table]:type()
}
