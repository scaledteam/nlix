#
# This E2 made by scaled
#

@name egp-wm-shell

switch (stateGet()) {
    # Wait console driver
    case 0,
        if (terminalInit()) {
            stateNext()
        }
        break
    
    # Wait keyboard driver
    case 1,
        if (simpleKeyboardInit()) {
            stateNext()
        }
        break
    
    # Wait callback device
    case 2,
        if (driverPopDevice("egp-wm-callback")) {
            stateNext()
        }
        break
    
    # Main state
    case 3,
        terminalPrint("wm-sh: $ ")
        simpleKeyboardRequestInput()
        
        stateNext()
        break
    
    # Get input
    case 4,
        if (simpleKeyboardWaitInput()) {
            local Input = simpleKeyboardGetInput()
            local Commands = Input:trim():explode(" ")
            
            local CallbackDevice = varTable("device")
            foreach (I, Command:string = Commands) {
                CallbackDevice["queue", array]:pushString(Command)
            }
            stateSet(3)
        }
        break
}
