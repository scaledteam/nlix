#
# This E2 made by scaled
#

@name sh

if (!APPS_INFO:exists("sh")) {
    local Info = table()
    
    APPS_INFO["sh", table] = Info
}

if (app("sh")) {
    switch (ThisAppState) {
        # Wait terminal driver
        case 0,
            if (initTerminal()) {
                appNextState()
            }
            break
        # Wait keyboard driver
        case 1,
            if (initSimpleKeyboard()) {
                appNextState()
            }
            break
        # Main state
        case 2,
            terminalPrint(ThisAppUser + " $ ")
            requestKeyboardInput()
            
            appNextState()
            break
        # Get input
        case 3,
            if (waitKeyboardInput()) {
                local Command = getKeyboardInput()
                if (Command == "") {
                    appSetState(2)
                }
                else {
                    local App = command(Command)
                    
                    if (App != NULL) {
                        varWrite("LaunchedApp", App)
                        appNextState()
                    }
                    else {
                        terminalPrint("Error! App \"" + Command + "\" not found.\n")
                        appSetState(2)
                    }
                }
            }
            
            break
        # Track launcher app
        case 4,
            if (!varTable("LaunchedApp"):appIsLaunched()) {
                appSetState(2)
            }
            break
    }
}
