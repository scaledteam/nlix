#
# Created by scaled
#

@name libdevices

function number deviceGet(Type:string) {
    if (S["devices", table]:exists(Type) & P["device", wirelink] == nowirelink()) {
        local Devices = S["devices", table][Type, array]
        
        if (Devices:count() > 0) {
            local Device = Devices:shiftWirelink()
            if (Device != nowirelink() & Device:entity():isValid()) {
                P["device", wirelink] = Device
                S["devices", table]["P", table]:pushTable(P)
                S["devices", table]["D", table]:pushWirelink(Device)
                
                if (Devices:count() == 0) {
                    S["devices", table]:remove(Type)
                }
                return 1
            }
        }
        else {
            S["devices", table]:remove(Type)
        }
    }
    return 0
}

function string wirelink:type() {
    local Name = This:entity():type()
    
    if (Name == "gmod_wire_expression2" | Name == "expadv_gate") {
        Name = This:entity():getName()
    }
    
    return Name
}
