#
# Created by scaled
#

@name libkernel
@persist NULL:table

function table exec(Name:string) {
    if (PEnabled[Name, number]) {
        if (P) {
            Program = table("name" = Name, "parent" = P)
        }
        else {
            Program = table("name" = Name)
        }
        Ps:pushTable(Program)
        
        return Program
    }
    else {
        return NULL
    }
}

function end() {
    if(Ps[KState, table] == P){
        Ps:removeTable(KState):clear()
        KState--
    }
    else {
        P:clear()
    }
    
    P = NULL
}

function programUp() {
    if(Ps[KState, table] == P){
        Ps:remove(KState)
        Ps:pushTable(P)
        KState = Ps:count()
    }
}

function table:execNow() {
    local Super = P
    P = Program
    P["name", string]()
    P = Super
}
