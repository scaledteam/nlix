#
# Created by scaled
#

@name libkernel
@persist NULL:table

function table exec(Name:string) {
    if (PList[Name, number]) {
        if (P) {
            Program = table("name" = Name, "parent" = P)
        }
        else {
            Program = table("name" = Name)
        }
        KTasks:pushTable(Program)
        
        return Program
    }
    else {
        return NULL
    }
}

function end() {
    if(KTasks[KState, table] == P) {
        KTasks:removeTable(KState):clear()
        KState--
    }
    else {
        P:clear()
    }
    
    P = NULL
}

function programUp() {
    if(KTasks[KState, table] == P) {
        KTasks:remove(KState)
        KTasks:pushTable(P)
        KState = KTasks:count()
    }
}

function table:execNow() {
    if (P != NULL) {
        local Super = P
        P = Program
        P["name", string]()
        P = Super
    }
}
