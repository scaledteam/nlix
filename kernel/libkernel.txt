#
# Created by scaled
#

@name libkernel
@persist PExist:table

function table exec(Name:string) {
    if (PExist[Name, number]) {
        if (P) {
            Program = table("function" = Name, "parent" = P)
        }
        else {
            Program = table("function" = Name)
        }
        KTasks:pushTable(Program)
        
        return Program
    }
    else {
        return NULL
    }
}

function end() {
    if(KTasks[KTaskId, table] == P) {
        KTasks:remove(KTaskId)
        P:clear()
        KTaskId--
    }
    else {
        P:clear()
    }
    
    P = NULL
}

function tackUp() {
    if (KTasks[KTaskId, table] == P) {
        KTasks:remove(KTaskId)
        KTasks:pushTable(P)
        KTaskId = KTasks:count()
    }
}

function table:execNow() {
    if (P != NULL) {
        local Super = P
        P = Program
        P["function", string]()
        P = Super
    }
}

function number table:changeProgram(Function:string) {
    if (PExist[Function, number]) {
        This["function", string] = Function
        return 1
    }
    else {
        return 0
    }
}
